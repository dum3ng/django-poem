const path = require('path')
const webpack = require('webpack')
const UglifyJSPlugin = require('uglifyjs-webpack-plugin')
const CompressionPlugin = require("compression-webpack-plugin")

const NODE_MODULES = path.resolve(__dirname, 'node_modules')

const config = {
  entry: {
    poem: path.join(__dirname, 'poem/static/poem/src/index.jsx'),
  },
  output: {
    path: path.join(__dirname, 'poem/static/poem/dist/'),
    filename: '[name]-bundle.min.js'
  },
  resolve: {
    extensions: ['.', '.js', '.jsx'],

  },
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        use: 'babel-loader',
      },
      {
        test: /.css$/,
        use: [{
          loader: 'style-loader'
        },
              {
               loader: 'css-loader',
               options: {modules:true}
        }],
      },
    ],
  },
   plugins: [
     new UglifyJSPlugin(),
      new CompressionPlugin({
            asset: "[path].gz[query]",
            algorithm: "gzip",
            test: /\.(js|html)$/,
            threshold: 10240,
            minRatio: 0.8
        })
   ],
}

module.exports = config
